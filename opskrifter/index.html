<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Opskrifter – sunde snacks og nemme idéer | Sund Snack</title>
  <meta name="description" content="Find alle opskrifter på Sund Snack. Søg i sunde snacks, filtrér på kategorier og tags, og find din næste favorit." />
  <link rel="canonical" href="https://www.sund-snack.dk/opskrifter/" />

  <meta property="og:title" content="Opskrifter – sunde snacks og nemme idéer | Sund Snack" />
  <meta property="og:description" content="Søg og filtrér blandt alle opskrifter fra Sund Snack – sunde snacks, proteinrige bites og hurtige idéer." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.sund-snack.dk/opskrifter/" />
  <meta property="og:image" content="https://www.sund-snack.dk/assets/images/hero-opskrifter.jpg" />

  <meta name="theme-color" content="#16a34a" />
  <link rel="stylesheet" href="/assets/styles.css" />
  <script src="/assets/site.js" defer></script>

  <style>
    .container{width:min(1100px, calc(100% - 2rem));margin:0 auto}

    /* hero */
    .hero{
      padding:26px 0 18px;
    }
    .hero-card{
      border-radius:24px;
      border:1px solid rgba(11,18,32,.10);
      box-shadow:0 18px 60px rgba(11,18,32,.10);
      overflow:hidden;
      background:#fff;
    }
    .hero-inner{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:18px;
      padding:18px;
      align-items:center;
      position:relative;
    }
    @media (max-width:980px){.hero-inner{grid-template-columns:1fr}}

    .hero-copy h1{
      margin:0;
      font-size:clamp(2rem,3.4vw,2.8rem);
      font-weight:950;
      letter-spacing:-.02em;
    }
    .hero-copy p{
      margin:10px 0 0;
      color:rgba(11,18,32,.72);
      font-weight:650;
      max-width:70ch;
      line-height:1.55;
    }

    .hero-media{
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(11,18,32,.10);
      background:rgba(11,18,32,.03);
      min-height:210px;
      position:relative;
    }
    .hero-media img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    /* search + controls */
    .controls{margin-top:14px;display:flex;flex-direction:column;gap:10px}
    .search-row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .search-input{
      flex:1;
      min-width:min(640px,100%);
      padding:14px 16px;
      border:1px solid rgba(11,18,32,.12);
      border-radius:999px;
      background:#fff;
      box-shadow:0 8px 22px rgba(11,18,32,.06);
      font-size:1rem;
      font-weight:650;
      outline:none;
    }
    .search-input:focus{border-color:rgba(22,163,74,.40)}
    .btnx{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:.78rem 1rem;
      border-radius:999px;
      border:1px solid rgba(11,18,32,.12);
      background:#fff;
      font-weight:900;
      cursor:pointer;
      user-select:none;
      transition:transform .08s ease, background .15s ease, border-color .15s ease;
    }
    .btnx:active{transform:scale(.98)}
    .btnx.primary{
      border-color:rgba(22,163,74,.28);
      background:rgba(22,163,74,.08);
      color:#0b3d1f;
    }
    .btnx.ghost{
      background:rgba(11,18,32,.03);
    }
    .select{
      padding:.74rem 1rem;
      border-radius:999px;
      border:1px solid rgba(11,18,32,.12);
      background:#fff;
      font-weight:850;
      cursor:pointer;
    }

    .meta-line{
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-top:4px;
      color:rgba(11,18,32,.68);
      font-weight:650;
    }

    /* filter chips */
    .filters{
      display:none;
      margin-top:8px;
      border-top:1px solid rgba(11,18,32,.08);
      padding-top:12px;
    }
    .filters.is-open{display:block}

    .chip-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width:980px){.chip-grid{grid-template-columns:1fr}}

    .cardx{
      background:#fff;
      border:1px solid rgba(11,18,32,.10);
      border-radius:18px;
      box-shadow:0 8px 22px rgba(11,18,32,.08);
      padding:14px;
    }
    .cardx h2{margin:0 0 10px;font-size:1.05rem;font-weight:950;letter-spacing:-.01em}
    .chip-row{display:flex;flex-wrap:wrap;gap:8px}
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:.42rem .72rem;
      border-radius:999px;
      border:1px solid rgba(11,18,32,.12);
      background:rgba(11,18,32,.03);
      font-weight:900;
      cursor:pointer;
      user-select:none;
      transition:background .15s ease, border-color .15s ease, transform .08s ease;
    }
    .chip:active{transform:scale(.98)}
    .chip.is-on{
      border-color:rgba(22,163,74,.35);
      background:rgba(22,163,74,.10);
      color:#0b3d1f;
    }

    /* recipes grid */
    .section{padding:10px 0 56px}
    .grid{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:14px;
      margin-top:14px;
    }
    @media (max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:640px){.grid{grid-template-columns:1fr}}

    .mini-card{
      background:#fff;
      border:1px solid rgba(11,18,32,.10);
      border-radius:18px;
      overflow:hidden;
      box-shadow:0 6px 18px rgba(11,18,32,.08);
      transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease;
    }
    .mini-card:hover{
      transform:translateY(-2px);
      border-color:rgba(22,163,74,.25);
      box-shadow:0 14px 34px rgba(11,18,32,.10);
    }
    .mini-thumb{
      height:160px;
      background-size:cover;
      background-position:center;
      background-color:rgba(11,18,32,.05);
    }
    .mini-body{padding:12px}
    .mini-title{margin:0 0 6px;font-weight:950;letter-spacing:-.01em}
    .mini-desc{margin:0;color:rgba(11,18,32,.72);font-weight:650}
    .pill-row{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:.38rem .62rem;
      border-radius:999px;
      border:1px solid rgba(11,18,32,.12);
      background:rgba(11,18,32,.03);
      font-weight:900;
      font-size:.92rem;
    }

    .empty{
      padding:18px;
      border:1px dashed rgba(11,18,32,.18);
      border-radius:18px;
      background:rgba(11,18,32,.02);
      margin-top:14px;
    }
    .empty h3{margin:0 0 6px}
    .muted{color:rgba(11,18,32,.68);font-weight:650}
    a{color:inherit;text-decoration:none}
  </style>
</head>

<body>
  <div id="siteHeader"></div>

  <main>
    <section class="hero">
      <div class="container">
        <div class="hero-card">
          <div class="hero-inner">
            <div class="hero-copy">
              <h1>Opskrifter</h1>
              <p>
                Søg i alle vores sunde snacks og hurtige idéer. Brug filtrene til at finde proteinrige snacks, noget uden bagning,
                eller bare en nem favorit til hverdagen.
              </p>

              <div class="controls">
                <div class="search-row">
                  <input id="q" class="search-input" type="search" inputmode="search" autocomplete="off"
                         placeholder="Søg efter fx “banan”, “protein”, “uden bagning” …" />

                  <button class="btnx ghost" type="button" id="toggleFiltersBtn" aria-expanded="false">
                    Filtre
                  </button>

                  <select id="sort" class="select" aria-label="Sortering">
                    <option value="new">Nyeste</option>
                    <option value="az">A–Z</option>
                    <option value="fast">Hurtigst</option>
                  </select>

                  <button class="btnx" type="button" id="clearBtn">Nulstil</button>
                </div>

                <div class="meta-line">
                  <div><span id="countText">Indlæser opskrifter…</span></div>
                  <div class="muted">Tip: klik på chips for at filtrere</div>
                </div>

                <div id="filters" class="filters" aria-label="Filtre">
                  <div class="chip-grid">
                    <div class="cardx">
                      <h2>Kategorier</h2>
                      <div id="catChips" class="chip-row"></div>
                    </div>
                    <div class="cardx">
                      <h2>Tags</h2>
                      <div id="tagChips" class="chip-row"></div>
                    </div>
                  </div>
                </div>

              </div>
            </div>

            <div class="hero-media" aria-hidden="true">
              <!-- lav selv billedet senere -->
              <img src="/assets/images/hero-opskrifter.jpg" alt="" loading="eager" />
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="container">
        <div id="grid" class="grid"></div>
        <div id="empty" class="empty" style="display:none;">
          <h3>Ingen resultater</h3>
          <p class="muted">Prøv at søge efter noget andet, eller nulstil filtre.</p>
        </div>
      </div>
    </section>
  </main>

  <div id="siteFooter"></div>

  <script>
    // -----------------------------
    // Partials
    // -----------------------------
    async function loadPartial(mountId, url) {
      const el = document.getElementById(mountId);
      if (!el) return;
      try {
        const res = await fetch(url, { cache: "no-store" });
        el.innerHTML = await res.text();
      } catch {}
    }
    loadPartial("siteHeader", "/partials/header.html");
    loadPartial("siteFooter", "/partials/footer.html");

    // -----------------------------
    // Opskrifter index
    // -----------------------------
    (async () => {
      const qs = (s, r=document) => r.querySelector(s);
      const qsa = (s, r=document) => Array.from(r.querySelectorAll(s));
      const norm = (s) => String(s || "").toLowerCase().trim();

      const grid = qs("#grid");
      const empty = qs("#empty");
      const qInput = qs("#q");
      const countText = qs("#countText");
      const sortSel = qs("#sort");
      const filtersWrap = qs("#filters");
      const toggleFiltersBtn = qs("#toggleFiltersBtn");
      const clearBtn = qs("#clearBtn");
      const catChipsEl = qs("#catChips");
      const tagChipsEl = qs("#tagChips");

      let all = [];
      let state = {
        q: "",
        cats: new Set(),
        tags: new Set(),
        sort: "new"
      };

      // URL params (så man kan linke til en søgning)
      function readParams() {
        const p = new URLSearchParams(location.search);
        state.q = p.get("q") || "";
        state.sort = p.get("sort") || "new";
        const c = (p.get("cat") || "").split(",").map(x => norm(x)).filter(Boolean);
        const t = (p.get("tag") || "").split(",").map(x => norm(x)).filter(Boolean);
        state.cats = new Set(c);
        state.tags = new Set(t);
      }
      function writeParams() {
        const url = new URL(location.href);
        if (state.q) url.searchParams.set("q", state.q); else url.searchParams.delete("q");
        if (state.sort && state.sort !== "new") url.searchParams.set("sort", state.sort); else url.searchParams.delete("sort");

        const c = Array.from(state.cats);
        const t = Array.from(state.tags);
        if (c.length) url.searchParams.set("cat", c.join(",")); else url.searchParams.delete("cat");
        if (t.length) url.searchParams.set("tag", t.join(",")); else url.searchParams.delete("tag");
        history.replaceState({}, "", url.toString());
      }

      // Build chips from data
      function uniqSorted(arr) {
        const set = new Set(arr.map(norm).filter(Boolean));
        return Array.from(set).sort((a,b) => a.localeCompare(b, "da"));
      }

      function renderChips(container, items, type) {
        container.innerHTML = "";
        items.forEach(val => {
          const b = document.createElement("button");
          b.type = "button";
          b.className = "chip";
          b.dataset.value = val;
          b.dataset.type = type;
          b.textContent = val;
          container.appendChild(b);
        });
      }

      // Score & filter
      function matches(item) {
        const hay = norm(item.title) + " " + norm(item.description) + " " +
          (Array.isArray(item.categories) ? item.categories.map(norm).join(" ") : "") + " " +
          (Array.isArray(item.tags) ? item.tags.map(norm).join(" ") : "");

        const qOK = !state.q || hay.includes(norm(state.q));

        const itemCats = new Set((item.categories || []).map(norm));
        const itemTags = new Set((item.tags || []).map(norm));

        const catsOK = state.cats.size === 0 || Array.from(state.cats).every(c => itemCats.has(c));
        const tagsOK = state.tags.size === 0 || Array.from(state.tags).every(t => itemTags.has(t));

        return qOK && catsOK && tagsOK;
      }

      function sortList(list) {
        const copy = [...list];
        const byAZ = (a,b) => String(a.title||"").localeCompare(String(b.title||""), "da");
        const byFast = (a,b) => (Number(a.minutes||9999) - Number(b.minutes||9999)) || byAZ(a,b);

        // "Nyeste": hvis I senere tilføjer datePublished/date til json, tager vi det. Indtil da: behold rækkefølgen i json.
        if (state.sort === "az") return copy.sort(byAZ);
        if (state.sort === "fast") return copy.sort(byFast);
        return copy; // new
      }

      function formatPills(item) {
        const pills = [];
        if (item.minutes) pills.push(`⏱ ${item.minutes} min`);
        if (item.level) pills.push(`⭐ ${item.level}`);
        const cats = (item.categories || []).slice(0,2);
        cats.forEach(c => pills.push(`#${c}`));
        return pills;
      }

      function render(list) {
        grid.innerHTML = "";
        const filtered = sortList(list.filter(matches));

        if (countText) {
          const total = all.length;
          const shown = filtered.length;
          countText.textContent = shown === total
            ? `${shown} opskrifter`
            : `${shown} af ${total} opskrifter`;
        }

        if (!filtered.length) {
          if (empty) empty.style.display = "block";
          return;
        }
        if (empty) empty.style.display = "none";

        grid.innerHTML = filtered.map(r => {
          const img = r.image || "/assets/images/hero.jpg";
          const title = r.title || "Opskrift";
          const desc = r.description || "";
          const url = r.url || "#";
          const pills = formatPills(r).map(p => `<span class="pill">${p}</span>`).join("");

          return `
            <article class="mini-card">
              <a class="card-link" href="${url}">
                <div class="mini-thumb" style="background-image:url('${img}')"></div>
                <div class="mini-body">
                  <h3 class="mini-title">${title}</h3>
                  <p class="mini-desc">${desc}</p>
                  <div class="pill-row">${pills}</div>
                </div>
              </a>
            </article>
          `;
        }).join("");
      }

      function syncUI() {
        if (qInput) qInput.value = state.q || "";
        if (sortSel) sortSel.value = state.sort || "new";

        // highlight selected chips
        qsa(".chip").forEach(ch => {
          const val = norm(ch.dataset.value);
          const type = ch.dataset.type;
          const on = (type === "cat") ? state.cats.has(val) : state.tags.has(val);
          ch.classList.toggle("is-on", on);
        });

        render(all);
        writeParams();
      }

      function resetAll() {
        state.q = "";
        state.cats = new Set();
        state.tags = new Set();
        state.sort = "new";
        syncUI();
      }

      // open/close filters
      function setFiltersOpen(open) {
        filtersWrap.classList.toggle("is-open", open);
        toggleFiltersBtn.setAttribute("aria-expanded", open ? "true" : "false");
        toggleFiltersBtn.classList.toggle("primary", open);
      }

      // Load json
      try {
        readParams();

        const res = await fetch("/assets/opskrifter.json", { cache: "no-store" });
        const data = await res.json();
        all = Array.isArray(data) ? data : (data.recipes || []);

        // build chip lists
        const cats = uniqSorted(all.flatMap(r => r.categories || []));
        const tags = uniqSorted(all.flatMap(r => r.tags || []));

        renderChips(catChipsEl, cats, "cat");
        renderChips(tagChipsEl, tags, "tag");

        // attach listeners
        if (qInput) {
          qInput.addEventListener("input", () => {
            state.q = qInput.value || "";
            syncUI();
          });
        }
        if (sortSel) {
          sortSel.addEventListener("change", () => {
            state.sort = sortSel.value;
            syncUI();
          });
        }
        if (clearBtn) clearBtn.addEventListener("click", resetAll);

        if (toggleFiltersBtn) {
          toggleFiltersBtn.addEventListener("click", () => {
            const open = !filtersWrap.classList.contains("is-open");
            setFiltersOpen(open);
          });
        }

        document.addEventListener("click", (e) => {
          const chip = e.target.closest(".chip");
          if (!chip) return;
          const val = norm(chip.dataset.value);
          const type = chip.dataset.type;

          if (type === "cat") {
            if (state.cats.has(val)) state.cats.delete(val); else state.cats.add(val);
          } else {
            if (state.tags.has(val)) state.tags.delete(val); else state.tags.add(val);
          }
          syncUI();
        });

        // initial UI
        syncUI();

        // auto-open filters if params have filters
        if (state.cats.size || state.tags.size) setFiltersOpen(true);

      } catch (e) {
        if (countText) countText.textContent = "Kunne ikke indlæse opskrifter.";
        if (empty) {
          empty.style.display = "block";
          empty.querySelector("h3").textContent = "Der skete en fejl";
          empty.querySelector("p").textContent = "Tjek at /assets/opskrifter.json findes og er gyldigt JSON.";
        }
      }
    })();
  </script>
</body>
</html>
