<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Opskrifter – sunde snacks og nemme idéer | Sund Snack</title>
  <meta name="description" content="Find alle opskrifter på Sund Snack. Søg direkte i heroen og filtrér på kategorier og tags – alle opskrifter hentes automatisk fra opskrifter.json." />
  <link rel="canonical" href="https://www.sund-snack.dk/opskrifter/" />

  <meta property="og:title" content="Opskrifter – Sund Snack" />
  <meta property="og:description" content="Søg blandt sunde opskrifter og filtrér på tags og kategorier – alt samlet ét sted." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.sund-snack.dk/opskrifter/" />
  <meta property="og:image" content="https://www.sund-snack.dk/assets/images/hero-opskrifter.jpg" />

  <meta name="theme-color" content="#16a34a" />
  <link rel="stylesheet" href="/assets/styles.css" />
  <script src="/assets/site.js" defer></script>

  <style>
    /* ===== HERO (1:1 fra forsiden) ===== */
    .hero--full{position:relative;height:520px;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .hero-media{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;transform:scale(1.02)}
    .hero-overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.45),rgba(0,0,0,.45))}
    .hero-content{position:relative;text-align:center;color:#fff;padding:0 1rem}
    .hero-title{margin:0 0 10px;font-size:clamp(2.1rem,4.4vw,3.4rem);font-weight:900;letter-spacing:-.02em}
    .hero-subtitle{margin:0 0 22px;font-size:clamp(1rem,1.5vw,1.25rem);opacity:.92;font-weight:600}

    .hero-searchwrap{width:min(860px,100%);margin:0 auto}
    .hero-searchbar{background:#fff;border-radius:999px;display:flex;align-items:center;padding:10px 14px;box-shadow:0 18px 50px rgba(0,0,0,.25)}
    .hero-searchbar input{flex:1;border:0;outline:0;height:56px;font-size:1.05rem;padding:0 12px;border-radius:999px}
    .hero-searchbtn{width:56px;height:56px;border:0;border-radius:999px;background:transparent;cursor:pointer;display:grid;place-items:center;color:rgba(0,0,0,.7)}
    .hero-searchbtn svg{width:22px;height:22px}

    .hero-actions{display:flex;justify-content:center;margin-top:16px}
    .hero-filterbtn{
      background:rgba(0,0,0,.35);
      color:#fff;
      border:1px solid rgba(255,255,255,.35);
      border-radius:999px;
      padding:.55rem .95rem;
      font-weight:800;
      cursor:pointer;
    }
    .hero-filterbtn:hover{background:rgba(0,0,0,.45)}

    /* ===== Filters drawer (samme som du sendte: .drawer) ===== */
    .drawer{position:fixed;inset:0;display:none;z-index:100}
    .drawer[aria-hidden="false"]{display:block}
    .drawer-backdrop{position:absolute;inset:0;background:rgba(0,0,0,.45)}
    .drawer-panel{
      position:absolute;right:0;top:0;height:100%;width:min(420px,100%);
      background:#fff;border-left:1px solid rgba(0,0,0,.10);
      padding:18px 16px;overflow:auto;
      box-shadow:-20px 0 60px rgba(0,0,0,.18);
    }
    .drawer-head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:12px}
    .drawer-title{margin:0;font-size:1.05rem;font-weight:900}
    .drawer-close{
      width:44px;height:44px;border-radius:12px;border:1px solid rgba(0,0,0,.12);
      background:rgba(0,0,0,.04);cursor:pointer;font-weight:900
    }
    .filter-group{padding:12px 0;border-top:1px solid rgba(0,0,0,.08)}
    .filter-group:first-of-type{border-top:0}
    .filter-label{display:block;font-weight:900;margin-bottom:8px}
    .chiprow{display:flex;flex-wrap:wrap;gap:8px}
    .fchip{
      border:1px solid rgba(0,0,0,.12);
      background:#fff;
      padding:.5rem .75rem;
      border-radius:999px;
      cursor:pointer;
      font-weight:800;
    }
    .fchip[aria-pressed="true"]{
      border-color: rgba(22,163,74,.45);
      background: rgba(22,163,74,.10);
    }
    .drawer-actions{display:flex;gap:10px;margin-top:14px}
    .btnx{
      flex:1;display:inline-flex;align-items:center;justify-content:center;
      padding:.85rem 1rem;border-radius:999px;border:1px solid rgba(0,0,0,.12);
      background:#fff;font-weight:900;cursor:pointer
    }
    .btnx-primary{border-color:transparent;background:#16a34a;color:#fff}
    .btnx-primary:hover{filter:brightness(.96)}
    .btnx:hover{background:rgba(0,0,0,.04)}

    /* ===== Results grid (1:1 vibe) ===== */
    .section{padding:26px 0 56px}
    .section-head{display:flex;flex-direction:column;gap:6px;margin-bottom:14px}
    .section-head h2{margin:0;font-size:1.25rem;letter-spacing:-.01em}
    .muted{color:rgba(11,18,32,.68)}
    .container{width:min(1100px, calc(100% - 2rem));margin:0 auto}

    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    @media (max-width:980px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:640px){
      .hero--full{height:480px}
      .hero-searchbar{padding:8px 10px}
      .hero-searchbar input{height:52px;font-size:1rem}
      .hero-searchbtn{width:52px;height:52px}
      .grid{grid-template-columns:1fr}
    }

    .card{
      background:#fff;border:1px solid rgba(11,18,32,.10);border-radius:18px;overflow:hidden;
      box-shadow:0 6px 18px rgba(11,18,32,.08);
      transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease;
    }
    .card:hover{transform:translateY(-2px);border-color:rgba(22,163,74,.25);box-shadow:0 14px 34px rgba(11,18,32,.10)}
    .card-link{display:block;height:100%}
    .thumb{height:160px;background-size:cover;background-position:center;background-color:rgba(11,18,32,.05)}
    .card-body{padding:14px;display:flex;flex-direction:column;height:calc(100% - 160px)}
    .card-meta{margin:0 0 8px;font-weight:900;font-size:.85rem;color:rgba(11,18,32,.60)}
    .card-title{margin:0 0 8px;font-size:1.05rem;line-height:1.22;letter-spacing:-.01em}
    .card-desc{margin:0 0 12px;color:rgba(11,18,32,.70);font-weight:600;flex:1}
    .card-tags{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px}
    .tag{display:inline-flex;padding:.28rem .55rem;border-radius:999px;border:1px solid rgba(22,163,74,.18);background:rgba(22,163,74,.08);font-weight:900;font-size:.8rem}
    .card-cta{font-weight:900;color:rgba(22,163,74,.95)}

    .empty{padding:22px;border:1px dashed rgba(11,18,32,.18);border-radius:18px;background:rgba(11,18,32,.02)}
    .empty h3{margin:0 0 6px}
  </style>
</head>

<body>
  <div id="siteHeader"></div>

  <main>
    <!-- HERO (samme som forsiden, bare nyt billede + tekst) -->
    <section class="hero hero--full">
      <img class="hero-media" src="/assets/images/hero-opskrifter.jpg" alt="Sunde snacks og opskrifter" loading="eager" />
      <div class="hero-overlay" aria-hidden="true"></div>

      <div class="hero-content container">
        <h1 class="hero-title">Opskrifter</h1>
        <p class="hero-subtitle">Søg blandt alle vores sunde snacks – og filtrér på kategorier og tags.</p>

        <div class="hero-searchwrap">
          <form class="hero-searchbar" role="search" onsubmit="return false;">
            <input id="q" type="search" placeholder="Søg efter opskrift..." autocomplete="off" />
            <button id="searchBtn" class="hero-searchbtn" type="button" aria-label="Søg">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16Zm11 3-6.1-6.1" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </form>

          <!-- Filtre knap UNDER søgebjælken (samme) -->
          <div class="hero-actions">
            <button id="openFilters" class="hero-filterbtn" type="button">Filtre +</button>
          </div>
        </div>
      </div>
    </section>

    <!-- RESULTS -->
    <section class="section">
      <div class="container">
        <div class="section-head">
          <h2 id="resultsTitle">Opskrifter</h2>
          <p class="muted" id="resultsHint">Søg i feltet ovenfor for at filtrere.</p>
        </div>

        <div id="recipesGrid" class="grid" aria-live="polite"></div>

        <div id="emptyState" class="empty" hidden>
          <h3>Ingen opskrifter matcher din søgning</h3>
          <p class="muted">Prøv et andet søgeord – fx “protein”, “skyr” eller “wrap”.</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Filters drawer (KORREKT: matcher CSS .drawer) -->
  <div id="filtersDrawer" class="drawer" aria-hidden="true">
    <div class="drawer-backdrop" data-close></div>

    <aside class="drawer-panel" role="dialog" aria-modal="true" aria-label="Filtre">
      <div class="drawer-head">
        <h3 class="drawer-title">Filtre</h3>
        <button class="drawer-close" type="button" data-close aria-label="Luk">✕</button>
      </div>

      <div class="filter-group">
        <span class="filter-label">Kategorier</span>
        <div id="filtersCats" class="chiprow"></div>
      </div>

      <div class="filter-group">
        <span class="filter-label">Tags</span>
        <div id="filtersTags" class="chiprow"></div>
      </div>

      <div class="drawer-actions">
        <button id="resetFilters" class="btnx" type="button">Nulstil</button>
        <button id="applyFilters" class="btnx btnx-primary" type="button">Anvend filtre</button>
      </div>
    </aside>
  </div>

  <div id="siteFooter"></div>

  <script>
    // -----------------------------
    // Partials loader (header/footer)
    // -----------------------------
    async function loadPartial(mountId, url) {
      const el = document.getElementById(mountId);
      if (!el) return;
      try {
        const res = await fetch(url, { cache: "no-store" });
        el.innerHTML = await res.text();
      } catch {}
    }
    loadPartial("siteHeader", "/partials/header.html");
    loadPartial("siteFooter", "/partials/footer.html");

    // -----------------------------
    // Search + Filters (samme side)
    // -----------------------------
    const qs = (s, r=document) => r.querySelector(s);
    const norm = (s) => String(s || "").toLowerCase().trim().replace(/\s+/g," ");

    const input = qs("#q");
    const searchBtn = qs("#searchBtn");

    const grid = qs("#recipesGrid");
    const emptyState = qs("#emptyState");
    const resultsTitle = qs("#resultsTitle");
    const resultsHint = qs("#resultsHint");

    const drawer = qs("#filtersDrawer");
    const openFiltersBtn = qs("#openFilters");
    const applyFiltersBtn = qs("#applyFilters");
    const resetFiltersBtn = qs("#resetFilters");

    const catsEl = qs("#filtersCats");
    const tagsEl = qs("#filtersTags");

    let ALL = [];
    let selectedCats = new Set();
    let selectedTags = new Set();

    function getQFromURL(){
      const p = new URLSearchParams(location.search);
      return p.get("q") || "";
    }
    function setQToURL(v){
      const url = new URL(location.href);
      if (v) url.searchParams.set("q", v);
      else url.searchParams.delete("q");
      history.replaceState({}, "", url.toString());
    }

    function recipeToText(r){
      return norm([r.title, r.description, (r.categories||[]).join(" "), (r.tags||[]).join(" ")].join(" "));
    }

    function openDrawer(){
      drawer.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
    }
    function closeDrawer(){
      drawer.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
    }

    function makeChip(label, setRef){
      const b = document.createElement("button");
      b.className = "fchip";
      b.type = "button";
      b.textContent = label;
      b.setAttribute("aria-pressed", setRef.has(label) ? "true" : "false");
      b.addEventListener("click", () => {
        if (setRef.has(label)) setRef.delete(label);
        else setRef.add(label);
        b.setAttribute("aria-pressed", setRef.has(label) ? "true" : "false");
      });
      return b;
    }

    function rebuildFilterChips(list){
      const cats = new Set();
      const tags = new Set();
      list.forEach(r => {
        (r.categories||[]).forEach(c => cats.add(c));
        (r.tags||[]).forEach(t => tags.add(t));
      });

      catsEl.innerHTML = "";
      tagsEl.innerHTML = "";

      Array.from(cats).sort((a,b)=>a.localeCompare(b,"da")).forEach(c => catsEl.appendChild(makeChip(c, selectedCats)));
      Array.from(tags).sort((a,b)=>a.localeCompare(b,"da")).forEach(t => tagsEl.appendChild(makeChip(t, selectedTags)));
    }

    function matchesFilters(r){
      if (selectedCats.size){
        const rc = new Set((r.categories||[]));
        let ok = false;
        selectedCats.forEach(c => { if (rc.has(c)) ok = true; });
        if (!ok) return false;
      }
      if (selectedTags.size){
        const rt = new Set((r.tags||[]));
        let ok = false;
        selectedTags.forEach(t => { if (rt.has(t)) ok = true; });
        if (!ok) return false;
      }
      return true;
    }

    function renderCards(list){
      grid.innerHTML = list.map(r => {
        const cats = (r.categories || []).slice(0, 3);
        const meta = [r.minutes ? `${r.minutes} min` : "", r.level ? r.level : ""].filter(Boolean).join(" • ");
        return `
          <article class="card">
            <a class="card-link" href="${r.url || "#"}">
              <div class="thumb" style="background-image:url('${r.image || ""}')"></div>
              <div class="card-body">
                <div class="card-top">
                  ${meta ? `<p class="card-meta">${meta}</p>` : `<p class="card-meta muted"> </p>`}
                  <h3 class="card-title">${r.title || "Opskrift"}</h3>
                  <p class="card-desc">${r.description || ""}</p>
                </div>
                <div class="card-tags">
                  ${cats.map(c => `<span class="tag">${c}</span>`).join("")}
                </div>
                <div class="card-cta">Se opskrift →</div>
              </div>
            </a>
          </article>
        `;
      }).join("");
    }

    function updateUI(query, filtered){
      if (!query){
        resultsTitle.textContent = "Opskrifter";
        resultsHint.textContent = "Søg i feltet ovenfor for at filtrere.";
      } else {
        resultsTitle.textContent = `Søgeresultater for “${query}”`;
        resultsHint.textContent = "Resultater opdateres live, mens du skriver.";
      }
      emptyState.hidden = filtered.length !== 0;
      grid.hidden = filtered.length === 0;
    }

    function filterAndRender(query){
      const q = norm(query);
      setQToURL(query);

      let filtered = !q ? ALL : ALL.filter(r => recipeToText(r).includes(q));
      filtered = filtered.filter(matchesFilters);

      renderCards(filtered);
      updateUI(query, filtered);
    }

    async function loadRecipes(){
      try{
        const res = await fetch("/assets/opskrifter.json", { cache: "no-store" });
        const data = await res.json();
        ALL = Array.isArray(data) ? data : (data.recipes || []);
        if (!Array.isArray(ALL)) ALL = [];
      } catch {
        ALL = [];
      }
    }

    function bindDrawer(){
      openFiltersBtn.addEventListener("click", openDrawer);

      drawer.addEventListener("click", (e) => {
        if (e.target && e.target.matches("[data-close]")) closeDrawer();
      });

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && drawer.getAttribute("aria-hidden") === "false") closeDrawer();
      });

      applyFiltersBtn.addEventListener("click", () => {
        closeDrawer();
        filterAndRender(input.value);
      });

      resetFiltersBtn.addEventListener("click", () => {
        selectedCats = new Set();
        selectedTags = new Set();
        rebuildFilterChips(ALL);
        filterAndRender(input.value);
      });
    }

    async function init(){
      const initialQ = getQFromURL();
      if (initialQ) input.value = initialQ;

      bindDrawer();

      await loadRecipes();
      rebuildFilterChips(ALL);
      filterAndRender(input.value);

      input.addEventListener("input", () => filterAndRender(input.value));
      searchBtn.addEventListener("click", () => filterAndRender(input.value));
    }

    init();
  </script>
</body>
</html>
